---
alwaysApply: false
description: Deep linking strategy for workflow and credential setupâ€”seamless navigation from chat to n8n UI.
---

# Decision Record: Credential Setup Deep Linking

## Context

Due to n8n API limitations, the extension cannot:
- List existing credentials (requires session cookies, not API keys)
- Pre-check credential availability
- Auto-link credentials to workflow nodes

This requires a different UX approach for credential setup.

## Decision

Implement **deep linking** to provide seamless navigation from the extension chat to n8n's UI for workflow viewing and credential configuration.

## Implementation

### Deep Link Structure

**Workflow Link:**
```
http://localhost:5678/workflow/{workflowId}
```
Opens the workflow directly in n8n's editor.

**Node-Specific Link:**
```
http://localhost:5678/workflow/{workflowId}/{nodeId}
```
Opens the workflow and focuses on a specific node. This allows users to:
- See the node that needs a credential
- Configure the credential directly on the node
- Select from existing credentials if available

**Credential Creation Link:**
```
http://localhost:5678/credentials/new/{credentialType}
```
Opens the credential creation page for a specific credential type.

### User Flow

1. **User clicks "Create & Open in n8n"**
   - Extension creates workflow via API
   - Receives workflow ID from n8n

2. **Extension provides node-specific deep links in chat:**
   ```
   âœ… Created workflow: [Open in n8n â†’]

   Next steps to activate:
   1. Send Message node: [Open node â†’] or [Create credential â†’]
   2. Read Gmail node: [Open node â†’] or [Create credential â†’]

   ðŸ’¡ Tip: If you already have credentials, click "Open node" to select them.
   Otherwise, create new ones.
   ```

3. **User clicks "Open node" link**
   - Opens workflow in n8n editor (new tab)
   - Focuses on the specific node needing credentials
   - Visual context showing exactly what needs configuration
   - **If credential exists:** User selects from dropdown
   - **If credential doesn't exist:** User clicks "Create New Credential" in node panel

4. **OR user clicks "Create credential" link**
   - Opens credential creation page in n8n
   - Pre-filled with correct credential type
   - User provides values and saves
   - Returns to workflow to select the credential

5. **User activates workflow**
   - All credentials configured
   - Workflow ready to run

### UI Components

**PlanPreview Component:**
- Button text adapts: "Create Workflow" vs "Create & Open in n8n"
- Shows tip about receiving direct links
- Credential links point to creation pages

**Chat Messages:**
- Markdown links in chat responses
- Numbered step-by-step guide
- Direct workflow and credential URLs

## Benefits

### User Experience
- âœ… **No searching** - Direct link to created workflow
- âœ… **Clear guidance** - Step-by-step instructions with clickable links
- âœ… **Visual context** - User sees workflow structure in n8n
- âœ… **Reduced friction** - One-click navigation between chat and n8n
- âœ… **Non-interruptive** - User chooses when to open links

### Technical
- âœ… **Simple implementation** - URL generation only
- âœ… **No API limitations** - Works with current n8n API
- âœ… **No session management** - Relies on user's existing n8n session
- âœ… **Maintainable** - Minimal code, clear logic

## Constraints

### URL Format Requirements
- Base URL must be configurable (localhost vs cloud)
- Credential types must match n8n's credential type names
- Workflow IDs provided by n8n API after creation
- Node IDs must match the node IDs in the workflow plan
- Node-level URLs: `/workflow/{workflowId}/{nodeId}`

### Browser Behavior
- Links open in new tabs (`target="_blank"`)
- User must be logged into n8n for links to work
- Extension does not track link clicks or completion

### Markdown Rendering
- Chat UI must support markdown link rendering
- Links format: `[Link text](url)`
- Future enhancement: Render as clickable elements

## Alternatives Considered

### API-Based Credential Creation
**Rejected** - Would require:
- Handling sensitive credential values in extension
- Trust issues from users
- Still can't detect duplicates
- Security concerns

### Status Monitoring
**Deferred** - Could implement:
- Poll workflow activation status
- Notify when workflow becomes active
- Requires additional complexity

### Content Script Session Access
**Too complex** - Would require:
- Accessing session cookies from page context
- Complex message passing
- Security implications
- Fragile to n8n UI changes

## Future Enhancements

### Implemented Features
1. âœ… **Node-specific deep links** - Direct links to nodes needing credentials
2. âœ… **Dual link strategy** - "Open node" OR "Create credential" per node
3. âœ… **Intelligent messaging** - Adapts based on whether user has existing credentials

### Possible Future Improvements
1. **Return navigation** - Track when user completes setup and returns to chat
2. **Workflow activation detection** - Poll workflow status and notify on activation
3. **Visual workflow preview** - Show miniature workflow diagram in chat
4. **Credential templates** - Provide example values or configuration hints
5. **Smart credential suggestions** - Detect partially matching credentials

### API Feature Requests
Request n8n team to add:
1. **Public credential listing** - Add GET support to `/api/v1/credentials`
2. **API key support for /rest/** - Allow API keys for internal endpoints
3. **Workflow status webhook** - Notify when workflow is activated

## References

- n8n API documentation: https://docs.n8n.io/api/
- n8n credential API: https://docs.n8n.io/api/api-reference/#tag/credential
- Related decision: 0011-n8n-api-integration.mdc

## Open Items

- Test deep linking with n8n Cloud instances
- Verify credential type names match across n8n versions
- Consider deep linking to specific nodes (if n8n supports it)
