---
alwaysApply: false
description: Project architecture—directories, layers, separation of concerns, and naming conventions.
---

# Decision Record: n8n Extension Project Architecture

## Goal
Define the core project architecture and structure for the n8n Pro Extension, a Chrome/Edge browser extension that provides AI-powered assistance for n8n workflow automation.

## Project Overview
This is a Chrome/Edge browser extension that provides AI-powered assistance for n8n workflow automation. The extension uses React + TypeScript with a multi-agent AI system.

## Core Architecture

### Entry Points
- **Content Script**: [src/entries/content/index.ts](mdc:src/entries/content/index.ts) - Content script that injects chat UI into n8n pages
- **Background Worker**: [src/entries/background/index.ts](mdc:src/entries/background/index.ts) - Service worker for AI orchestration
- **Options Page**: [src/entries/options/index.html](mdc:src/entries/options/index.html) - Settings and configuration page
- **Chat Panel**: [src/entries/content/chat/ChatPanel.tsx](mdc:src/entries/content/chat/ChatPanel.tsx) - Chat UI component

### Key Services
- **AI Orchestrator**: [src/ai/orchestrator/index.ts](mdc:src/ai/orchestrator/index.ts) - LangGraph-based AI agent orchestration
- **n8n Client**: [src/n8n/client.ts](mdc:src/n8n/client.ts) - n8n API client
- **OpenAI Service**: [src/ai/openai.ts](mdc:src/ai/openai.ts) - OpenAI integration
- **Chat Service**: [src/services/chat.ts](mdc:src/services/chat.ts) - Chat message coordination

### Configuration Files
- **Build Config**: [vite.config.ts](mdc:vite.config.ts) - Vite build configuration with multiple entry points
- **TypeScript Config**: [tsconfig.json](mdc:tsconfig.json) - TypeScript configuration with strict settings
- **ESLint Config**: [eslint.config.js](mdc:eslint.config.js) - ESLint v9 configuration for code quality
- **Manifest**: [public/manifest.json](mdc:public/manifest.json) - Chrome extension manifest

## Communication Flow
```
User Input → Content Script → Background Worker → AI Agents → n8n API
                ↓
Panel UI ← Background Worker ← AI Response ← LLM Provider
```

## File Structure
```
src/
├── entries/        # Extension entry points
│   ├── background/ # Service worker
│   ├── content/    # Content script + chat UI
│   └── options/    # Options page
├── ui/             # React components
│   ├── primitives/ # Basic UI components
│   ├── feedback/   # Feedback components
│   ├── chat/       # Chat components
│   └── agent/      # Agent activity components
├── ai/             # AI/LLM code
│   ├── orchestrator/ # LangGraph agent system
│   ├── prompts/    # Prompt templates
│   └── openai.ts   # OpenAI service
├── platform/       # Browser platform APIs
├── n8n/            # n8n domain (client, types)
├── loom/           # Loom protocol
├── events/         # Event bus system
├── shared/         # Shared utilities, types
└── services/       # Business logic services
```

## Development Phases
See [development-milestones.md](mdc:development-milestones.md) for current progress and upcoming milestones.

## Project Checklist
See [project-checklist.md](mdc:project-checklist.md) for detailed task tracking and completion status.

## Why This Architecture
- **Multi-entry point design** enables different extension interfaces (popup, options, content script)
- **Service worker architecture** provides background processing and AI orchestration
- **React-based content script** enables rich UI integration with n8n pages
- **Modular service structure** promotes code reusability and maintainability
- **TypeScript integration** ensures type safety across all components
- **Vite build system** provides fast development and optimized production builds
